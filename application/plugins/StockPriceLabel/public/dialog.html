<script>
    App.StockPriceLabel_dialog={
        init:function(){
            $("input[name=pcomp_name]").val(App.pcomp.label);
            App.handler.progress(function(status){
		if( status==='passiveCompanySelected' ){
		    $("input[name=pcomp_name]").val(App.pcomp.label);
		}
	    });
            if(App.store('LabelPrintPcomp2_label')){
                $("input[name=pcomp_name2]").val(App.store('LabelPrintPcomp2_label'));
            };
        },
        print:function(){
            var config=[
                {field: "product_code", name: "Код товара", required: true},
                {field: "quantity", name: "Количество ценников"}
            ];
            App.loadWindow("page/dialog/importer",{label: 'ценник', fields_to_import: config,button_label: "Печать", button_img:"img/print.png"}).progress(function(status,fvalue,Importer){
                if( status==='submit' ){
                    console.log(fvalue);
                    window.open("StockPriceLabel/out/?out_type=.print&label=ценник&field="+
                            (fvalue.product_code)+"&quantity="+(fvalue.quantity) + "&pcomp2_id=" + 
                            (App.store('LabelPrintPcomp2_id')));
                }
            });
        },
        selectAdditionalPcomp: function(){
            App.loadWindow('page/company/tree',{}).progress(function(status,comp){
                if( status==='select' ){
                    App.store('LabelPrintPcomp2_id',comp.company_id);
                    App.store('LabelPrintPcomp2_label',comp.label);
                    $("input[name=pcomp_name2]").val(App.store('LabelPrintPcomp2_label'));
                }
                if( status==='reset' ){

                }
            });
        }
    };
    
</script>

<button type="button" onclick="App.StockPriceLabel_dialog.print()"><img src="img/import.png"> Открыть импортер</button>
<div>
    <div>
        <div style="display: inline-block; width:200px">Основная цена:</div>
        <input title="Для клиента" name="pcomp_name" value="не выбран" readonly="readonly" />
        <button type="button" class="tiny_button" onclick="App.user.pcompSelectionDialog();" ><img src="img/settings.png"> Выбрать</button>
    </div>
    <div>
        <div style="display: inline-block; width:200px">Дополнительная цена:</div>
        <input title="Для клиента" name="pcomp_name2" value="не выбран" readonly="readonly" />
        <button type="button" class="tiny_button" onclick="App.StockPriceLabel_dialog.selectAdditionalPcomp();"><img src="img/settings.png"> Выбрать</button>
    </div>
</div>