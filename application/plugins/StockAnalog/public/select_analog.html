<script type="text/javascript">
    /* global App */
    App.StockAnalog_select_analog = {
	init: function () {
	    this.node.window({
		title: 'Выбор аналогов',
		width: 650,
		height: 'auto',
		shadow:false,
		onClose: function () {
		    App.StockAnalog_select_analog.handler.notify('close');
		    delete App.StockAnalog_select_analog;
		}
	    });
	    this.node.window('hcenter');
	    this.node.window('window').css('position','fixed');
	    this.node.window('window').css('top','40px');
	},
	initAfter:function(){
	    $.post("StockAnalog/analogListGet",{doc_entry_id:this.data.doc_entry_id},function(resp){
                var analog_list=App.json(resp);
                if( analog_list ){
                    App.renderTpl('#StockAnalog_select_analog_options', analog_list);
                }
            });
	},
        swap:function( node ){
            var product_id=$(node).data('product_id');
            $.post("StockAnalog/analogEntrySwap",{doc_entry_id:this.data.doc_entry_id,product_id:product_id},function(ok){
                if(ok*1){
                    App.flash("Товар изменен на аналог");
                    App.StockAnalog_select_analog.node.window('close');
                } else {
                    App.flash("Не удалось заменить на аналог");
                }
            });
        }
    };
</script>
<h2>Выберите аналог для замены</h2>
<div id="StockAnalog_select_analog_options" class="covert">
    {{.}}
        <div></div>
        <div>Код</div>
        <div>Название</div>
        <div>Остаток</div>
        <div>Цена</div>
    <div class="StockAnalog_select_analog_options_row" style="display:contents" onclick="App.StockAnalog_select_analog.swap( this )" data-product_id="{{product_id}}">
        <div >
            {{if product_img}}
            <img src="Storage/image_flush/?size=50x50&path=/dynImg/{{product_img}}">
            {{/if}}
        </div>
        <div>{{product_code}}</div>
        <div>{{product_name}}</div>
        <div>{{product_quantity}}</div>
        <div>{{product_price}}</div>
    </div>
    {{/.}}
</div>
<style>
    #StockAnalog_select_analog_options{
        display:grid;
        grid-template-columns:50px 70px 400px 50px 50px;
        gap:2px 0px;
        margin: 10px;
    }
    .StockAnalog_select_analog_options_row div{
        background-color: #fff6;
        height: 50px;
        cursor: pointer;
    }
    .StockAnalog_select_analog_options_row:hover  div{
        background-color: #fe9;
    }
</style>