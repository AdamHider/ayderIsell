<script>
    App.document_manager=(function($){
        function init(){
            table.init();
        }
        
        
        
        
        
        
        var table={
            frm:{
		actionEditor:function (args) {
		    var $input;
		    var defaultValue;
		    this.keyCaptureList = [Slick.keyCode.UP, Slick.keyCode.DOWN, Slick.keyCode.ENTER];
		    this.init = function () {
			var html = "<select style='width:100%' data-docid='"+args.item.doc_id+"'>";
			for(var action in table.actionDictionary){
			    var actionName=table.actionDictionary[action];
			    html += "<option value='"+action+"'>"+actionName+"</option>";
			}
			html += "</select>";
			$input = $(html);
			$input.appendTo(args.container);
			$input.val(args.item.action);
			$input.focus();
		    };
		    this.destroy = function () {
			$input.remove();
		    };
		    this.focus = function () {
			$input.focus();
		    };
		    this.loadValue = function (item) {
			var initialAction=table.actionConfig[args.item.doc_id];
			$input.val(initialAction);
		    };
		    this.serializeValue = function () {
			return $input.val();
		    };
		    this.applyValue = function (item, state) {
			item[args.column.field] = state;
		    };
		    this.isValueChanged = function () {
			return (!($input.val() == "" && defaultValue == null)) && ($input.val() != defaultValue);
		    };
		    this.validate = function () {
			return {
			    valid: true,
			    msg: null
			};
		    };
		    this.init();
		},
                queue:function(row, cell, value, columnDef, dataContext){
                    return row+1;
                },
                dateFormatter:function(row, cell, value, columnDef, dataContext){
                    var date_parts=value.split(' ')[0].split('-');
                    var date=date_parts[2]+'.'+date_parts[1]+'.'+date_parts[0];
                    return '<span title="'+value.split(' ')[1]+'">'+date+'</span>';
                },
                tooltip:function(row, cell, value, columnDef, dataContext){
                    if( !value ){
                        return '';
                    }
                    var parts = value.split(' ');
                    var cmd = parts.shift();
                    if (cmd){
                        var style='max-width:16px;height:auto';
                        return '<img src="img/' + cmd + '.png" style="'+style+'" title="' + parts.join(' ') + '">';
                    }
                    else{
                        return '';
                    }	    
                },
		action:function(row,cell,value, columnDef, dataContext){
		    var action='skip';
		    if(dataContext.doc_id&&table.actionConfig[dataContext.doc_id]){
			action=table.actionConfig[dataContext.doc_id];
		    }
		    return table.actionDictionary[action];
		}
            },
	    actionDictionary:{
		skip:'✖ Игнор',
		add:'➕ Прибавить',
		extract:'➖ Вычесть'
	    },
	    actionConfig:{
		86:'skip',
		115:'add',
		88:'extract',
		125:'add'
	    },
            init:function(){
                var settings={
                    columns:[
                        {id:"action", name: "Действия", width: 100, editor: table.frm.actionEditor,formatter:table.frm.action },
                        {id:"cstamp", field: "cstamp",name: "Дата",  width: 70, sortable: true,formatter:table.frm.dateFormatter },
                        {id:"doc_num", field: "doc_num",name: "Номер", width: 50, sortable: true,cssClass:'slick-align-right' },
                        {id:"pcomp_label", field: "pcomp_label",name: "Контрагент", width: 120 },
                        {id:"doc_type_icon", field: "doc_type_icon",name: "", width: 25,formatter:table.frm.tooltip},
                        {id:"acomp_label", field: "acomp_label",name: "Наша фирма", width: 120 },
                        {id:"doc_total", field: "doc_total",name: "Сумма", width: 70, sortable: true }
                    ],
                    options:{
			editable: true,
                        enableCellNavigation: true,
                        enableColumnReorder: false,
                        enableFilter:true,
                        multiSelect :false,
                        url:'DocumentList/listFetch/'
                    }
                };
                table.grid = new SlickInfinite("#document_manager_sg", settings);
		
		//table.load();
		table.setupActionEvent();
		
		
                table.grid.setFilter({doc_id:"86|115|88|125"});
            },
	    setupActionEvent:function(){
		$("#document_manager_sg").change(function(e){
		    var doc_id=$(e.target).data('docid');
		    var value=$(e.target).val();
		    if( doc_id && value ){
			table.actionConfig[doc_id]=value;
		    }
		    console.log(value,doc_id);
		});
	    }
        };
        App.require(["js/slick/lib/jquery.event.drag-2.3.0.js"],function(){
            App.require([
                "js/slick/slick.core.js",
                "js/slick/plugins/slick.rowselectionmodel.js",
                "js/slick/slick.editors.js",
                "js/slick/slickinfinite.js",
                "js/slick/slick.grid.js"
            ], init);
        });
	return {
	    
	};
    })(jQuery);
</script>
<table>
    <tr>
        <td class="transp60" style="">
            <div id="document_manager_sg" style="height: 400px;width:580px"></div>
        </td>
        <td>
            sdgsdfg
        </td>
    </tr>
</table>