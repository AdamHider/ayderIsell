<script>
    App.document = {
	doc: {},
	init: function () {
	    App.document.initTab();
	    App.document.initCompDropdowns();
	    App.document.load(App.state.doc_id);
	},
	load: function (doc_id) {
	    $.post("documentGet/", {doc_id: doc_id}, function (resp) {
		App.document.doc = App.json(resp);
		App.document.render();
	    });
	},
	render: function () {
	    App.renderTpl('document_entries', App.document.doc);
	},
	initTab: function () {
	    $('.menu .item').tab({
		onVisible: function (type) {

		}
	    });
	    $('.menu .item').tab('change tab', 'entries');
	},
	initCompDropdowns: function () {
	    $('.activecomp').dropdown({
		apiSettings: {
		    url: 'compListFetch/'
		},
		fields: {
		    value: 'company_id',
		    name: 'label',
		    text:'path'
		},
		filterRemoteData:true,
		fullTextSearch:true
	    });
	}
    };
    $(App.document.init);
</script>


<h5 class="ui header">Клиент</h5>
<div class="ui fluid search selection remote dropdown activecomp">
    <input name="country" type="hidden">
    <i class="dropdown icon"></i>
    <div class="default text">Select Country</div>
    <div class="menu">
	<div class="item" data-value="af"><i class="af flag"></i>Afghanistan</div>
    </div>
</div>


<div class="ui top attached tabular menu">
    <a class="active item" data-tab="entries">Накладная</a>
    <a class="item" data-tab="prefs">Настройки</a>
</div>
<div class="ui bottom attached  tab segment" data-tab="entries" id="document_entries">
    <table class="ui green selectable  table  stackable">
	<thead>
	    <tr>
		<th>
		    <div class="ui grid">
			<div class="two wide column">№</div>
			<div class="fourteen wide column">Название</div>
		    </div>
		</th>
		<th>
		    <div class="ui grid">
			<div class="four wide column">Код</div>
			<div class="four wide column">Кол-во</div>
			<div class="four wide column">Цена</div>
			<div class="four wide column">Сумма</div>
		    </div>
		</th>
	    </tr>
	</thead>
	<tbody>
	    <!-- {{if entries}} {{entries}} -->
	    <tr data-doc-id="{{doc_entry_id}}" onclick="App.document.handleClick(this)">
		<td>{{##}}) {{product_name}}
		</td>
		<td>
		    <div class="ui grid">
			<div class="four wide column">{{product_code}}</div>
			<div class="four wide column">{{product_quantity}}{{product_unit}}</div>
			<div class="four wide column">{{product_price_total}}</div>
			<div class="four wide column">{{product_sum_total}}</div>
		    </div>
		</td>
	    </tr>
	    <!-- {{/entries}} {{else}}-->
	    <tr>
		<td colspan="4">Ничего не найдено</td>
	    </tr>
	    <!--{{/if}}-->
	</tbody>
	<tfoot class="full-width">
	    <tr>
		<td>
		    <div class="ui grid">
			<div class="eight wide column">{{footer.total_weight}}кг </div>
			<div class="eight wide column">{{footer.total_volume}}м<sup>3</sup></div>
		    </div>
		</td>
		<td style="text-align: right;">{{footer.total}}{{footer.curr_symbol}}</td>
	    </tr>
	</tfoot>
    </table>
</div>
<div class="ui bottom attached tab segment" data-tab="prefs" id="">

</div>



<style>
    #document_entries .four.wide.column{
	text-align: right;
    }
</style>
