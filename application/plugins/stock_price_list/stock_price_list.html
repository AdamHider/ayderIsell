<script src="js/jquery.sortable.js"></script>
<script>
    App.price_list=App.page_plugins_stock_price_list_stock_price_list={
	init:function(){
	    this.restoreLeftHeaders();
	    $(function () {
		App.price_list.initDrag();
	    });
	},
	initDrag:function(){
	    $('.connected').sortable('destroy');
	    $('.connected').sortable({
		connectWith: '.connected'
	    }).one('sortupdate', function(e, ui) {
		App.price_list.sortUpdate();
	    });
	},
	sortUpdate:function(){
	    this.restoreLeftHeaders();
	    this.initDrag();
	    this.saveUsedItems();
	},
	restoreLeftHeaders:function(){
	    $(".available_items .h1,.available_items .h2,.available_items .page").remove();
	    $(".available_items").prepend( $("#price_list_templates li").clone().attr('draggable',true) );
	},
	itemEdit:function( img_node ){
	    var li_node=$(img_node).parent();
	    if( li_node.hasClass('page') ){
		alert(555);
		return ;
	    }
	    var li_label=li_node.find('span').text();
	    var new_label=prompt("Введите текст заголовка",li_label);
	    if( new_label!==null ){
		li_node.find('span').text(new_label);
	    }
	},
	saveUsedItems:function(){
	    var price_list_id=1;
	    var items=[];
	    $(".used_items li").each(function(){
		items.push({
		    type:$(this).data('type'),
		    id:$(this).data('id'),
		    text:$(this).find('span').text()
		});
	    });
	    $.post("Plugin/stock_price_list/saveUsedItems/"+price_list_id,function(resp){
		
	    });
	}
    };
    
</script>
<div id="price_list_templates" style="display: none">
    <li data-type="h1" class="h1"><span>Большой заголовок</span> <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
    <li data-type="h2" class="h2"><span>Средний заголовок</span> <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
    <li data-type="page" class="page">Произвольный текст <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
</div>
<table>
    <tr>
	<td style="vertical-align: top;">
	    <ul class="connected available_items" style="width:200px">
		<li data-id="121" data-type="category"><span>Item 1</span> <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
		<li data-id="121" data-type="category"><span>Item 1</span> <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
		<li data-id="121" data-type="category"><span>Item 1</span> <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
		<li data-id="121" data-type="category"><span>Item 1</span> <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
		<li data-id="121" data-type="category"><span>Item 1</span> <img src="img/edit-16.png" onclick="App.price_list.itemEdit(this)"></li>
	    </ul>
	</td>
	<td style="vertical-align: top;">
	    <ul class="connected used_items" style="width:400px">
		
	    </ul>
	</td>
    </tr>
</table>
<style>
    .connected li{
	list-style: none;
	border: 1px solid #CCC;
	background: #fff;
	margin: 5px;
	padding: 5px;
	height: 22px;
    }
    .connected {
	float: left;
	padding: 15px;
	min-height: 100px;
	background-color: rgba(0,0,0,0.2);
    }
    li.h1{
	background-color: #fc0;
	padding: 4px;
	font-size: 18px;
    }
    li.h2{
	background-color: #FF9;
	font-size: 14px;
    }
    li.page{
	background-color: #Fcf;	
    }
    li.sortable-placeholder {
	border: 1px dashed #000;
	background: none;
    }
    li.sortable-dragging{}
    .available_items img{
	display: none;
    }
    .used_items img{
	float:right;
	padding: 2px;
    }
    .used_items img:hover{
	border: 1px solid #000;
	border-radius: 3px;
	margin: -1px;
	background-color: #ddd;
    }
</style>