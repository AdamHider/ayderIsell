<script>
    App[ App.getHolderId() ]=(function(){
	let holderId=App.getHolderId();
	let Document={
            doc_id:0,
            doc_extension:'',
            extention:{
                set:function( new_doc_extension ){
                    if( !new_doc_extension || Document.doc_extension===new_doc_extension ){
                        !new_doc_extension && console.log("Wrong extention"+new_doc_extension)
                        return ;
                    }
                    Document.doc_extension=new_doc_extension;
                    Document.extention.init();
                },
                init:function(){
                    Document.destroy();
                    if( !Document.doc_extension ){
                        console.log('document_model is '+Document.doc_extension);
                        App.flash("Не удалось загрузить плагин документа");
                        return false;
                    }
                    $.get(Document.doc_extension+'/extensionGet',function(resp){
                        var extension=App.json(resp);
                        if( extension && extension.head ){
                            $("#"+holderId+" .x-head").html(extension.head);
                        }
                        if( extension && extension.body ){
                            $("#"+holderId+" .x-body").html(extension.body);
                        }
                        if( extension && extension.foot ){
                            $("#"+holderId+" .x-foot").html(extension.foot);
                        }
                        if( extension && extension.views ){
                            $("#"+holderId+" .x-views").html(extension.views);
                        }
                        if( extension && extension.script ){
                            eval(extension.script);
                        }
                        Document.init();		
                    }).fail(function(){
                        App.flash("Не удалось загрузить плагин документа");
                    });
                }
            },
	    init:function(){
		Document.head.init();
		Document.body.init();
		Document.foot.init();
		Document.views.init();
	    },
	    render:function( render_data ){
		render_data.head && Document.head.render(render_data.head);
		render_data.body && Document.body.render(render_data.body);
		render_data.foot && Document.foot.render(render_data.foot);
		render_data.views && Document.views.render(render_data.views);
	    },
	    destroy:function(){
		Document.head.destroy();
		Document.body.destroy();
		Document.foot.destroy();
		Document.views.destroy();
                Document.reload();
		//$("#"+holderId).find(".x-head, .x-body, .x-foot, .x-views").html("");
	    },
	    load:function(id,parts_to_load){
		if( !Document.doc_extension ){
		    console.log('document_model is null');
		    return false;
		}
		parts_to_load= parts_to_load || ["head","body","foot","views"];
		Document.doc_id=id;
		var url=Document.doc_extension+'/documentGet';
		$.post(url,{doc_id:Document.doc_id,parts_to_load:JSON.stringify(parts_to_load)},function(resp){
		    var render_data=App.json(resp);
		    if(render_data){
			Document.render( render_data );
		    } else {
			App.flash("Не могу загрузить документ");
		    }
		});
	    },
	    reload:function(){
		var parts=["head","body","foot","views"];
                App.Topic('documentUpdated').publish();//why???
                Document.load(Document.doc_id,parts);
	    },
            delete:function(){
		$.post(Document.doc_extension+'/documentDelete',{doc_id:Document.doc_id},function(ok){
		    if(ok*1){
			Document.destroy();
                        App.flash("Документ удален");
		    } else {
			App.flash("Не могу удалить документ");
		    }
		});                
            },
            data:{
                head:{},
                body:{},
                foot:{},
                views:{}
            },
            head:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            },
            body:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            },
            foot:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            },
            views:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            }
        };
	return Document;
    })();
</script>
<style>
    #doclist_document_entries_sg input{
	width:100%;
	border: none;
    }
    .sugg_img{
	display:inline-block;
	width:35px;
    }
    .sugg_code{
	display: inline;
	width:50px;
	font-weight: bold;
    }
    .sugg_name{
	width:450px;
	display: inline-block;
    }
    .sugg_instock{
	cursor: pointer;
	min-height: 32px;
    }
    .sugg_outofstock{
	cursor: pointer;
	color: red;
	min-height: 32px;
    }
    .sugg_price{
	display: inline-block;
	width:50px;
	text-align: right;
    }
    .sugg_leftover{
	display: inline-block;
	width:50px;
	text-align: right;
	color:green;
    }
</style>
<div class="x-head"></div>
<div class="x-body"></div>
<div class="x-foot"></div>
<div class="x-views"></div>