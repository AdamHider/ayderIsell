<script>
    var holder_node_id = document.scripts[document.scripts.length - 1].parentNode.id;
    App[holder_node_id]=(function($){
	var holderId;
	function setHolderId(id){
	    holderId=id;
	}
	var document_model;
	var extension;
	/*
	 * INIT SECTION
	 */
	function init(doc_type){
	    function capitalize(s){
		return s && s[0].toUpperCase() + s.slice(1);
	    }
	    var dmodel=null;
	    if( $.isNumeric(doc_type) ){
		switch(doc_type){
		    case '1':
			dmodel='DocumentSell';
			break;
		    case '2':
			//dmodel='DocumentBuy';
			break;
		    case '3':
			//dmodel='DocumentServiceout';
			break;
		    case '4':
			//dmodel='DocumentServicein';
			break;
		}
	    } else if( doc_type.length>2 ) {//doc_type name must be at least 3 signs
		dmodel='Document'+capitalize(doc_type);
	    }
	    if( dmodel!==document_model ){
		document_model=dmodel;
		initExtension();
	    }
	}
	function initExtension(){
	    Document.destroy();
	    if( !document_model ){
		console.log('document_model is null');
		App.flash("Не удалось загрузить плагин документа");
		return false;
	    }
	    $.get(document_model+'/extensionGet',function(resp){
		extension=App.json(resp);
		if( extension && extension.head ){
		    $("#"+holderId+" .x-head").html(extension.head);
		}
		if( extension && extension.body ){
		    $("#"+holderId+" .x-body").html(extension.body);
		}
		if( extension && extension.foot ){
		    $("#"+holderId+" .x-foot").html(extension.foot);
		}
		if( extension && extension.views ){
		    $("#"+holderId+" .x-views").html(extension.views);
		}
		if( extension && extension.script ){
		    eval(extension.script);
		}
		Document.init();		
	    }).fail(function(){
		App.flash("Не удалось загрузить плагин документа");
	    });
	}
	var Document={
            doc_id:0,
	    init:function(){
		Document.head.init();
		Document.body.init();
		Document.foot.init();
		Document.views.init();
	    },
	    render:function( render_data ){
		render_data.head && Document.head.render(render_data.head);
		render_data.body && Document.body.render(render_data.body);
		render_data.foot && Document.foot.render(render_data.foot);
		render_data.views && Document.views.render(render_data.views);
	    },
	    destroy:function(){
		Document.head.destroy();
		Document.body.destroy();
		Document.foot.destroy();
		Document.views.destroy();
                Document.reload();
		//$("#"+holderId).find(".x-head, .x-body, .x-foot, .x-views").html("");
	    },
	    load:function(id,parts_to_load){
		if( !document_model ){
		    console.log('document_model is null');
		    return false;
		}
		parts_to_load= parts_to_load || ["head","body","foot","views"];
		Document.doc_id=id;
		var url=document_model+'/documentGet';
		$.post(url,{doc_id:Document.doc_id,parts_to_load:JSON.stringify(parts_to_load)},function(resp){
		    var render_data=App.json(resp);
		    if(render_data){
			Document.render( render_data );
		    } else {
			App.flash("Не могу загрузить документ");
		    }
		});
	    },
	    reload:function(){
		var parts=["head","body","foot","views"];
		Document.load(Document.doc_id,parts);
	    },
            delete:function(){
		$.post(document_model+'/documentDelete',{doc_id:Document.doc_id},function(ok){
		    if(ok*1){
			Document.destroy();
                        App.flash("Документ удален");
		    } else {
			App.flash("Не могу удалить документ");
		    }
		});                
            },
            data:{
                head:{},
                body:{},
                foot:{},
                views:{}
            },
            head:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            },
            body:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            },
            foot:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            },
            views:{
                init:function(){

                },
                render:function(){

                },
                destroy:function(){

                }
            }
        };
	return {
	    init:init,
	    load:Document.load,
	    setHolderId:setHolderId
	};
    })(jQuery);
    App[holder_node_id].setHolderId( holder_node_id );
</script>
<style>
    #doclist_document_entries_sg input{
	width:100%;
	border: none;
    }
    .sugg_img{
	display:inline-block;
	width:35px;
    }
    .sugg_code{
	display: inline;
	width:50px;
	font-weight: bold;
    }
    .sugg_name{
	width:450px;
	display: inline-block;
    }
    .sugg_instock{
	cursor: pointer;
	min-height: 32px;
    }
    .sugg_outofstock{
	cursor: pointer;
	color: red;
	min-height: 32px;
    }
    .sugg_price{
	display: inline-block;
	width:50px;
	text-align: right;
    }
    .sugg_leftover{
	display: inline-block;
	width:50px;
	text-align: right;
	color:green;
    }
    
</style>
<div class="x-head"></div>
<div class="x-body"></div>
<div class="x-foot"></div>
<div class="x-views"></div>