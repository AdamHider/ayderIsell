
<script>
    (function($){
	function init(){
	    App.initTabs('mtrade_main_tabs');
	    
	    showTree();
	    App.Topic('passiveCompanySelected').subscribe(function(company){
		$("#mtradePcompLabel").html(company.label);
	    });
	    App.Topic('passiveCompanyInited').subscribe(function(company){
		$("#mtradePcompLabel").html(company.label);
	    });
	    
	    labelsInit("#mtrade_main_labels","#mtrade_main_content");
	    
	}
	function showTree(){
	    App.loadModule('page/company/tree',{inline:true,clickselect:true},'mCtreeInline',/(Ctree|page_company_tree)([^\w]|_)/g,"mCtreeInline$2").progress(function(status,company){
		if( status==='select' ){
		    App.user.pcompSelect(company);
		    //TradeJs.initTabsOnce();
		}
		if( status==='deleted' && company==='company' ){
		    //TradeJs.showTabs(false);
		    App.pcomp={};
		}
	    });
	}
	
	function labelsInit(labels_id,content_id){
	    $(labels_id).click(function(e){
		$(labels_id).children().removeClass('left_label_selected');
		$(e.target).addClass('left_label_selected');
		
		$(content_id).children().hide();
		var path=$(e.target).data('href');
		labelsContentLoad(content_id,path);
	    });
	}
	function labelsContentLoad(content_id,path){
	    var id = path.replace(/\//g, '_');
	    if( $(content_id).find("#"+id).length<1 ){
		$(content_id).append("<div id='"+id+"'></div>");
	    }
	    $(content_id).find("#"+id).show();
	    if( !App[id] ){
		App.loadModule(path);
	    }
	}
	
	
	init();
    })(jQuery);
    
    
    
    
    

    

</script>

<div style="float: left">
    <div class="transp60" style="padding-bottom: 1px;margin-bottom: 2px;">
	<h2>Выбранный контрагент</h2>
	<div style="height:40px;">
	    <img src="img/gray.png">  <span class="link_button" title="Сменить клиента" id="mtradePcompLabel"></span>
	</div>
	<div id="mtrade_main_labels">
	    <div class="left_label" data-href="page/mtrade/document_list">Документы</div>
	    <div class="left_label" data-href="page/trade/payments">Взаиморасчет</div>
	    <div class="left_label" data-href="page/company/prefs">Настройки</div>
	    <div class="left_label" data-href="page/trade/details">Реквизиты</div>	    
	</div>
    </div>

    <div id="mCtreeInline" class="transp60"></div>
</div>
<div id="mtrade_main_content"></div>